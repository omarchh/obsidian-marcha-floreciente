/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var u=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var D=Object.prototype.hasOwnProperty;var C=(r,e)=>{for(var i in e)u(r,i,{get:e[i],enumerable:!0})},V=(r,e,i,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of T(e))!D.call(r,n)&&n!==i&&u(r,n,{get:()=>e[n],enumerable:!(t=A(e,n))||t.enumerable});return r};var y=r=>V(u({},"__esModule",{value:!0}),r);var v={};C(v,{default:()=>h});module.exports=y(v);var E=require("obsidian");var f=(r,e,i,t)=>{let n,s=/\{\{(.+?)(?:\|(.*?))?\}\}/g;for(n=s.exec(r);n!=null&&n.index!=null;){var a={text:n[1],start:n.index+2+e,end:n.index+2+n[1].length+e},d=void 0;n[2]!=null&&(d={text:n[2],start:a.end+e,end:s.lastIndex+e});var l=t.metadataCache.getFirstLinkpathDest(a.text,"")!=null;i.push({href:a,alias:d,start:n.index+e,end:s.lastIndex+e,exists:l}),n=s.exec(r)}},k=r=>{var i;let e=document.createElement("a");return e.href=r.href.text,e.innerText=((i=r.alias)!=null?i:r.href).text,e.addClass("internal-link"),r.exists||e.addClass("is-unresolved"),e};var L=require("@codemirror/view"),g=class extends L.WidgetType{constructor(i){super();this.linkSlice=i}toDOM(i){return k(this.linkSlice)}};var S=require("@codemirror/state"),o=require("@codemirror/view"),x=class{constructor(e,i){this.linkSlices=new Array;this.app=i,this.decorations=this.buildDecorations(e,this.app)}update(e){(e.docChanged||e.viewportChanged||e.selectionSet)&&(this.decorations=this.buildDecorations(e.view,this.app))}destroy(){}buildDecorations(e,i){let t=new S.RangeSetBuilder;return this.linkSlices=new Array,this.findLinks(e,this.linkSlices,i),this.linkSlices.sort((n,s)=>n.start-s.start),this.processLinks(e,t),t.finish()}findLinks(e,i,t){for(let n of e.visibleRanges){let s=e.state.sliceDoc(n.from,n.to),a=n.from;f(s,a,i,t)}}processLinks(e,i){for(let t of this.linkSlices){let n=e.state.selection.main.head;t.start<=n&&n<=t.end?this.styleLink(e,i,t):i.add(t.start,t.end,o.Decoration.replace({widget:new g(t)}))}}styleLink(e,i,t){let n=t.exists?"":" is-unresolved";t.alias==null?(i.add(t.start,t.start+2,o.Decoration.mark({class:"cm-formatting-link cm-formatting-link-start"})),i.add(t.href.start,t.href.end,o.Decoration.mark({class:"cm-link"+n})),i.add(t.end-2,t.end,o.Decoration.mark({class:"cm-formatting-link cm-formatting-link-end"}))):(i.add(t.start,t.start+2,o.Decoration.mark({class:"cm-formatting-link cm-formatting-link-start"})),i.add(t.href.start,t.href.end,o.Decoration.mark({class:"cm-link"+n})),i.add(t.href.end,t.href.end+1,o.Decoration.mark({class:"cm-hmd-internal-link"})),i.add(t.alias.start,t.alias.end,o.Decoration.mark({class:"cm-link"+n})),i.add(t.end-2,t.end,o.Decoration.mark({class:"cm-formatting-link cm-formatting-link-end"})))}},M={decorations:r=>r.decorations},w=r=>o.ViewPlugin.define(e=>new x(e,r),M);var P=r=>(e,i)=>{let t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),n=[],s;for(;s=t.nextNode();)n.push(s);for(let d of n){let l=d.parentNode;if(l==null)continue;let m=document.createDocumentFragment();var a=new Array;if(f(d.textContent,0,a,r),a.length==0)continue;let c=0;for(let p of a)p.start>c&&m.appendChild(document.createTextNode(d.textContent.slice(c,p.start-1))),m.appendChild(k(p)),c=p.end;c<d.textContent.length&&m.appendChild(document.createTextNode(d.textContent.slice(c-1))),l.replaceChild(m,d)}};var h=class extends E.Plugin{async onload(){this.editorPlugin=w(this.app),this.registerEditorExtension(this.editorPlugin),this.registerMarkdownPostProcessor(P(this.app))}onunload(){}};
